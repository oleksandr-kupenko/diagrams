"use strict";(self.webpackChunkdiagrams=self.webpackChunkdiagrams||[]).push([[183],{7183:(N,p,a)=>{a.r(p),a.d(p,{PublicModule:()=>T});var m=a(3603),_=a(2757),l=a(6019),t=a(1514),g=a(7908),w=a(9468),h=a(5077),u=a(858),x=a(3672);let b=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(o){return new(o||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-rectangular-block"]],decls:3,vars:0,consts:[[1,"rectangle"]],template:function(o,r){1&o&&(t.TgZ(0,"div",0),t.TgZ(1,"p"),t._uU(2,"rectangle"),t.qZA(),t.qZA())},styles:[".rectangle[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:100%}"]}),n})();function k(n,i){if(1&n){const o=t.EpF();t.ynx(0),t.O4$(),t.TgZ(1,"svg",1),t.TgZ(2,"defs"),t.TgZ(3,"marker",2),t._UZ(4,"path",3),t.qZA(),t.qZA(),t.TgZ(5,"line",4),t.NdJ("click",function(){return t.CHM(o),t.oxw().handleEditArrow()}),t.qZA(),t.qZA(),t.BQk()}if(2&n){const o=t.oxw();t.xp6(5),t.uIk("x1",o.coordinates.x1)("y1",o.coordinates.y1)("x2",o.coordinates.x2-4)("y2",o.coordinates.y2-4)}}let f=(()=>{class n{constructor(){}ngOnInit(){}handleEditArrow(){}}return n.\u0275fac=function(o){return new(o||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-arrow"]],inputs:{coordinates:"coordinates"},decls:1,vars:1,consts:[[4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","100%","height","100%"],["id","arrow","viewBox","0 0 10 10","refX","5","refY","5","markerWidth","10","markerHeight","10","orient","auto-start-reverse"],["d","M 0 0 L 10 5 L 0 10 z"],["marker-end","url(#arrow)","pathLength","1","stroke","black",3,"click"]],template:function(o,r){1&o&&t.YNc(0,k,6,4,"ng-container",0),2&o&&t.Q6J("ngIf",r.coordinates)},directives:[l.O5],styles:["[_nghost-%COMP%]   svg[_ngcontent-%COMP%]{position:absolute}"]}),n})();const C=["mainZone"],A=["block"];function v(n,i){if(1&n&&t._UZ(0,"app-arrow",13),2&n){const o=t.oxw().$implicit;t.Tol(o.key+"-arrow"),t.Q6J("coordinates",o.value)}}function O(n,i){if(1&n&&(t.ynx(0),t.YNc(1,v,1,3,"app-arrow",4),t.BQk()),2&n){const o=i.$implicit;t.xp6(1),t.Q6J("ngIf",o.value)}}function M(n,i){if(1&n){const o=t.EpF();t.ynx(0),t.TgZ(1,"div",5,6),t.NdJ("cdkDragMoved",function(e){const c=t.CHM(o).index;return t.oxw().handleMoveBlock(e,c)})("cdkDragStarted",function(){return t.CHM(o),t.oxw().handleSetPrevMoveArrowsList()})("cdkDragEnded",function(e){const c=t.CHM(o).index;return t.oxw().handleSaveBlcokNewCoordinates(c,e)}),t.TgZ(3,"button",7),t.NdJ("click",function(){const s=t.CHM(o).$implicit;return t.oxw().deleteBlock(s.id)}),t._uU(4," x "),t.qZA(),t.TgZ(5,"span",8),t.NdJ("clickOutside",function(){return t.CHM(o),t.oxw().cancelArrowCreate()})("click",function(e){const c=t.CHM(o).index;return t.oxw().addArrow("top",c,e)}),t.qZA(),t.TgZ(6,"span",9),t.NdJ("clickOutside",function(){return t.CHM(o),t.oxw().cancelArrowCreate()})("click",function(e){const c=t.CHM(o).index;return t.oxw().addArrow("right",c,e)}),t.qZA(),t.TgZ(7,"span",10),t.NdJ("clickOutside",function(){return t.CHM(o),t.oxw().cancelArrowCreate()})("click",function(e){const c=t.CHM(o).index;return t.oxw().addArrow("bottom",c,e)}),t.qZA(),t.TgZ(8,"span",11),t.NdJ("clickOutside",function(){return t.CHM(o),t.oxw().cancelArrowCreate()})("click",function(e){const c=t.CHM(o).index;return t.oxw().addArrow("left",c,e)}),t.qZA(),t._UZ(9,"app-rectangular-block"),t.qZA(),t.YNc(10,O,2,1,"ng-container",12),t.ALo(11,"keyvalue"),t.BQk()}if(2&n){const o=i.index,r=t.oxw();t.xp6(1),t.ekj("active",o==r.currentChangingBlockIndex),t.xp6(9),t.Q6J("ngForOf",t.lcZ(11,3,r.arrowList))}}function y(n,i){if(1&n&&t._UZ(0,"app-arrow",13),2&n){const o=t.oxw();t.Tol(o.currentNewArrow.position+"-arrow"),t.Q6J("coordinates",o.currentNewArrow.coordinates)}}let P=(()=>{class n{constructor(){this.isCreateArrowMode=!1,this.currentNewArrow=null,this.currentChangingBlockIndex=null,this.arrowList={},this.blocksList=[{id:(0,u.Z)(),translate3d:"translate3d(100px, 35px, 0px)",arrows:{top:null,right:null,bottom:null,left:null}}],this.mouseSubscribe=new g.w0,this.mainZoneLeft=0,this.mainZoneTop=0}ngAfterViewInit(){this.arrangeBlocksInPlace(),this.mainZoneLeft=this.mainZone.nativeElement.offsetLeft,this.mainZoneTop=this.mainZone.nativeElement.offsetTop}cancelArrowCreate(){this.mouseSubscribe.unsubscribe(),this.isCreateArrowMode=!1,this.currentChangingBlockIndex=null}identify(o,r){return r.id}handleAddBlock(){this.blocksList=[...this.blocksList,{id:(0,u.Z)(),translate3d:"translate3d(198px, 325px, 0px)",arrows:{top:null,right:null,bottom:null,left:null}}],this.blocksDomElements.changes.pipe((0,w.q)(1)).subscribe(()=>{this.arrangeBlocksInPlace()})}deleteBlock(o){const r=[];this.blocksList.forEach(e=>{Object.values(e.arrows).forEach(s=>{s&&s.arrowId&&r.push(s.arrowId)})}),r.length&&r.forEach(e=>{delete this.arrowList[e],this.removeArrowInBlocks(e)}),this.blocksList=this.blocksList.filter(e=>e.id!=o)}handleSaveBlcokNewCoordinates(o,r){console.log(r);const e=this.blocksDomElements.toArray()[o].nativeElement.style.transform;this.blocksList[o].translate3d=e,console.log(this.blocksList)}handleSetPrevMoveArrowsList(){this.prevMoveArrowsList=JSON.parse(JSON.stringify(this.arrowList))}handleMoveBlock(o,r){let e=this.blocksList[r].arrows;Object.keys(e).map(s=>{let c=e[s];c&&("start"===c.type?(this.arrowList[c.arrowId].x1=this.prevMoveArrowsList[c.arrowId].x1+o.distance.x,this.arrowList[c.arrowId].y1=this.prevMoveArrowsList[c.arrowId].y1+o.distance.y):"end"===c.type&&(this.arrowList[c.arrowId].x2=this.prevMoveArrowsList[c.arrowId].x2+o.distance.x,this.arrowList[c.arrowId].y2=this.prevMoveArrowsList[c.arrowId].y2+o.distance.y))})}arrangeBlocksInPlace(){this.blocksDomElements.forEach((o,r)=>{o.nativeElement.setAttribute("style",`transform: ${this.blocksList[r].translate3d}`)})}removeArrowInBlocks(o){this.blocksList.forEach(r=>{Object.keys(r.arrows).forEach(e=>{let s=r.arrows[e];s&&s.arrowId==o&&(r.arrows[e]=null)})})}removeOldArrow(o,r){var e;const s=null===(e=this.blocksList[r].arrows[o])||void 0===e?void 0:e.arrowId;s&&(delete this.arrowList[s],this.removeArrowInBlocks(s))}calculateMiddleBlockCoodrinates(o,r){switch(o){case"top":return{x:r.left+r.width/2-this.mainZoneLeft,y:r.top-this.mainZoneTop};case"right":return{x:r.left+r.width-this.mainZoneLeft,y:r.top+r.height/2-this.mainZoneTop};case"bottom":return{x:r.left+r.width/2-this.mainZoneLeft,y:r.top-this.mainZoneTop+r.height};case"left":return{x:r.left-this.mainZoneLeft,y:r.top+r.height/2-this.mainZoneTop}}}setCurrentNewArrowCoordinates(o,r,e,s){const c=this.calculateMiddleBlockCoodrinates(o,e.target.parentElement.getBoundingClientRect());this.currentNewArrow={coordinates:{x1:"start"==s?c.x:this.currentNewArrow.coordinates.x1,y1:"start"==s?c.y:this.currentNewArrow.coordinates.y1,x2:c.x,y2:c.y},position:"start"==s?o:this.currentNewArrow.position,startBlockIndex:"start"==s?r:this.currentNewArrow.startBlockIndex}}addArrow(o,r,e){e.stopPropagation(),console.log(e),this.removeOldArrow(o,r),this.isCreateArrowMode?(this.cancelArrowCreate(),this.setCurrentNewArrowCoordinates(o,r,e,"end"),this.saveArrow(r,o)):(this.currentChangingBlockIndex=r,this.setCurrentNewArrowCoordinates(o,r,e,"start"),this.isCreateArrowMode=!0,this.observeMouse())}saveArrow(o,r){const e=Object.keys(this.arrowList).length?+Object.keys(this.arrowList)[Object.keys(this.arrowList).length-1]+1:1;this.arrowList[+e]=this.currentNewArrow.coordinates,this.blocksList=this.blocksList.map((s,c)=>c==this.currentNewArrow.startBlockIndex?Object.assign(Object.assign({},s),{arrows:Object.assign(Object.assign({},s.arrows),{[this.currentNewArrow.position]:{arrowId:e,type:"start"}})}):c==o?Object.assign(Object.assign({},s),{arrows:Object.assign(Object.assign({},s.arrows),{[r]:Object.assign(Object.assign({},s.arrows[r]),{arrowId:e,type:"end",side:r})})}):Object.assign({},s)),this.currentNewArrow=null}observeMouse(){this.mouseSubscribe=(0,h.R)(document.body,"mousemove").subscribe(o=>{this.currentNewArrow=Object.assign(Object.assign({},this.currentNewArrow),{coordinates:Object.assign(Object.assign({},this.currentNewArrow.coordinates),{x2:o.pageX-this.mainZoneLeft,y2:o.pageY-this.mainZoneTop})})})}}return n.\u0275fac=function(o){return new(o||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-public"]],viewQuery:function(o,r){if(1&o&&(t.Gf(C,7,t.SBq),t.Gf(A,5,t.SBq)),2&o){let e;t.iGM(e=t.CRH())&&(r.mainZone=e.first),t.iGM(e=t.CRH())&&(r.blocksDomElements=e)}},decls:7,vars:3,consts:[[3,"click"],[1,"diagrams-zone"],["mainZone",""],[4,"ngFor","ngForOf","ngForTrackBy"],["class","arrow",3,"coordinates","class",4,"ngIf"],["cdkDragBoundary",".diagrams-zone","cdkDrag","",1,"diagrams-zone__block",3,"cdkDragMoved","cdkDragStarted","cdkDragEnded"],["block",""],[1,"diagrams-zone__block--delete-btn",3,"click"],["appBackDrop","",1,"top-compound","compound",3,"clickOutside","click"],["appBackDrop","",1,"right-compound","compound",3,"clickOutside","click"],["appBackDrop","",1,"bottom-compound","compound",3,"clickOutside","click"],["appBackDrop","",1,"left-compound","compound",3,"clickOutside","click"],[4,"ngFor","ngForOf"],[1,"arrow",3,"coordinates"]],template:function(o,r){1&o&&(t._uU(0,"Diagrams "),t.TgZ(1,"button",0),t.NdJ("click",function(){return r.handleAddBlock()}),t._uU(2,"ADD BLOCK"),t.qZA(),t.TgZ(3,"section",1,2),t.YNc(5,M,12,5,"ng-container",3),t.YNc(6,y,1,3,"app-arrow",4),t.qZA()),2&o&&(t.xp6(5),t.Q6J("ngForOf",r.blocksList)("ngForTrackBy",r.identify),t.xp6(1),t.Q6J("ngIf",r.isCreateArrowMode&&r.currentNewArrow))},directives:[l.sg,l.O5,_.Zt,x.G,b,f],pipes:[l.Nd],styles:[".diagrams-zone[_ngcontent-%COMP%]{margin-top:50px;height:600px;width:600px;max-width:100%;border:2px solid blue;position:relative}.diagrams-zone__block[_ngcontent-%COMP%]{width:200px;height:70px;border:solid 2px #969292;transition:box-shadow .2s cubic-bezier(0,0,.2,1);position:absolute;z-index:10}.diagrams-zone__block[_ngcontent-%COMP%]:hover, .diagrams-zone__block.active[_ngcontent-%COMP%]{box-shadow:0 3px 1px -2px #0003,0 2px 2px #00000024,0 1px 5px #0000001f}.diagrams-zone__block[_ngcontent-%COMP%]   .compound[_ngcontent-%COMP%]{cursor:pointer;max-width:16px;max-height:16px;border:1px solid black;width:100%;height:100%;border-radius:50%;background-color:#8c7ddb;position:absolute;z-index:10;display:none}.diagrams-zone__block[_ngcontent-%COMP%]   .compound.active[_ngcontent-%COMP%]{display:block}.diagrams-zone__block[_ngcontent-%COMP%]   .compound.top-compound[_ngcontent-%COMP%]{top:-8px;left:calc(50% - 8px)}.diagrams-zone__block[_ngcontent-%COMP%]   .compound.right-compound[_ngcontent-%COMP%]{top:calc(50% - 8px);right:-9px}.diagrams-zone__block[_ngcontent-%COMP%]   .compound.bottom-compound[_ngcontent-%COMP%]{bottom:-7px;left:calc(50% - 8px)}.diagrams-zone__block[_ngcontent-%COMP%]   .compound.left-compound[_ngcontent-%COMP%]{top:calc(50% - 8px);left:-9px}.diagrams-zone__block--delete-btn[_ngcontent-%COMP%]{display:none;align-items:center;justify-content:center;position:absolute;right:4px;top:4px;background-color:#e75b5b;border-radius:50px;cursor:pointer;color:#fff;border:none;transition:.2s}.diagrams-zone__block--delete-btn[_ngcontent-%COMP%]:hover{background-color:#9e4040}.diagrams-zone__block[_ngcontent-%COMP%]:hover   .diagrams-zone__block--delete-btn[_ngcontent-%COMP%]{display:flex}.diagrams-zone__block[_ngcontent-%COMP%]:hover   .compound[_ngcontent-%COMP%]{display:block}.diagrams-zone__block.active[_ngcontent-%COMP%]   .compound[_ngcontent-%COMP%]{display:none}"]}),n})();var Z=a(3999);const L=[{path:"",component:P}];let T=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[l.ez,m.o,_._t,Z.Bz.forChild(L)]]}),n})()}}]);